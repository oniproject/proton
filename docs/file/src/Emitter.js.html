<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Emitter.js | Proton API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/behaviour/Alpha.js~Alpha.html">Alpha</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Attraction.js~Attraction.html">Attraction</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/BaseRender.js~BaseRender.html">BaseRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Behaviour.js~Behaviour.html">Behaviour</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/BehaviourEmitter.js~BehaviourEmitter.html">BehaviourEmitter</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/CanvasRender.js~CanvasRender.html">CanvasRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/zone/CircleZone.js~CircleZone.html">CircleZone</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Collision.js~Collision.html">Collision</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Color.js~Color.html">Color</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/math/ColorSpan.js~ColorSpan.html">ColorSpan</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/CrossZone.js~CrossZone.html">CrossZone</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/DomRender.js~DomRender.html">DomRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/EaselRender.js~EaselRender.html">EaselRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Emitter.js~Emitter.html">Emitter</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/FollowEmitter.js~FollowEmitter.html">FollowEmitter</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Force.js~Force.html">Force</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Gravity.js~Gravity.html">Gravity</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/GravityWell.js~GravityWell.html">GravityWell</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~ImageTarget.html">ImageTarget</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/zone/ImageZone.js~ImageZone.html">ImageZone</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Initialize.html">Initialize</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Life.html">Life</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/zone/LineZone.js~LineZone.html">LineZone</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Mass.html">Mass</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/math/Mat3.js~Mat3.html">Mat3</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Particle.js~Particle.html">Particle</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/ParticlePool.js~ParticlePool.html">ParticlePool</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/PixelRender.js~PixelRender.html">PixelRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/PixiRender.js~PixiRender.html">PixiRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/zone/PointZone.js~PointZone.html">PointZone</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/math/Polar2D.js~Polar2D.html">Polar2D</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Position.html">Position</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Proton.js~Proton.html">Proton</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Radius.html">Radius</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/RandomDrift.js~RandomDrift.html">RandomDrift</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Rate.html">Rate</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/zone/RectZone.js~RectZone.html">RectZone</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/math/Rectangle.js~Rectangle.html">Rectangle</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/Renderer.js~Renderer.html">Renderer</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Repulsion.js~Repulsion.html">Repulsion</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Rotate.js~Rotate.html">Rotate</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/behaviour/Scale.js~Scale.html">Scale</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/math/Span.js~Span.html">Span</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/math/Vector2D.js~Vector2D.html">Vector2D</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Initialize.js~Velocity.html">Velocity</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/render/WebGLRender.js~WebGLRender.html">WebGLRender</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Zone.js~Zone.html">Zone</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-createCanvas">createCanvas</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-degreeTransform">degreeTransform</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-getImage">getImage</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-getSpanValue">getSpanValue</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-hexToRGB">hexToRGB</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-ipot">ipot</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-loadAndSetImage">loadAndSetImage</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-loadedImage">loadedImage</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-nhpot">nhpot</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-randomAToB">randomAToB</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-rgbToHex">rgbToHex</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-setSpanValue">setSpanValue</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-transformDom">transformDom</a></span></li>
</ul>
</div>

<div data-ice="variableWrap">
  <h2><a href="variable/">Variable</a></h2>
  <ul>
    
  <li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-EMITTER_ADDED">EMITTER_ADDED</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-EMITTER_REMOVED">EMITTER_REMOVED</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-EULER">EULER</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-MEASURE">MEASURE</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-PARTICLE_CREATED">PARTICLE_CREATED</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-PARTICLE_DEAD">PARTICLE_DEAD</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-PARTICLE_SLEEP">PARTICLE_SLEEP</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-PARTICLE_UPDATE">PARTICLE_UPDATE</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-POOL_MAX">POOL_MAX</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-PROTON_UPDATE">PROTON_UPDATE</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-PROTON_UPDATE_AFTER">PROTON_UPDATE_AFTER</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-RK2">RK2</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-RK4">RK4</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-TIME_STEP">TIME_STEP</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-TextureBuffer">TextureBuffer</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-TextureBuffer">TextureBuffer</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-TextureCanvasBuffer">TextureCanvasBuffer</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-TextureCanvasBuffer">TextureCanvasBuffer</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-VERLET">VERLET</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-amendChangeTabsBug">amendChangeTabsBug</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-integrator">integrator</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-pool">pool</a></span></li>
</ul>
</div>




</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Emitter.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import EventEmitter from &apos;eventemitter3&apos;

import {
	integrator, pool,
	PARTICLE_CREATED, PARTICLE_UPDATE, PARTICLE_DEAD
} from &apos;./Proton&apos;
import Particle from &apos;./Particle&apos;
import {Initialize, Rate} from &apos;./Initialize&apos;
import {degreeTransform} from &apos;./util&apos;


//setPrototypeByObject
//setVector2DByObject

/** @private */
var EMITTER_ID = 0

/**
 * You can use this emit particles.
 *
 * It will dispatch follow events:
 * PARTICLE_CREATED
 * PARTICLE_UPDATA
 * PARTICLE_DEAD
 *
 * @extends {Particle}
 * @extends {EventEmitter}
 */
export default class Emitter extends Particle {
	 /**
	 * @param {Object} pObj the parameters object
	 * for example {damping:0.01,bindEmitter:false}
	 */
	constructor(pObj) {
		super(pObj)

		// TODO EventEmitter
		this._events = undefined
		this.addEventListener = EventEmitter.prototype.on
		this.removeEventListener = EventEmitter.prototype.off
		this.removeAllEventListeners = EventEmitter.prototype.removeAllListeners
		//this.hasEventListener = EventEmitter.hasEventListener
		this.dispatchEvent = EventEmitter.prototype.emit

		this.initializes = []
		this.particles = []
		this.behaviours = []
		this.emitTime = 0
		this.emitTotalTimes = -1

		/**
		 * The friction coefficient for all particle emit by This
		 * @property {Number} damping
		 * @default 0.006
		 */
		this.damping = .006

		/**
		 * If bindEmitter the particles can bind this emitter&apos;s property
		 * @property {Boolean} bindEmitter
		 * @default true
		 */
		this.bindEmitter = true

		/**
		 * The number of particles per second emit (a [particle]/b [s])
		 * @property {Rate} rate
		 * @default Rate(1, .1)
		 */
		this.rate = new Rate(1, .1)

		/**
		 * The emitter&apos;s id
		 * @property id
		 * @type {String} id
		 */
		this.id = &apos;emitter_&apos; + EMITTER_ID++
	}

	/**
	 * start emit particle
	 * @param {Number} emitTime begin emit time
	 * @param {String} life the life of this emitter
	 */
	emit(emitTime = Infinity, life) {
		this.emitTime = 0
		this.emitTotalTimes = emitTime

		if (life == true || life == &apos;life&apos; || life == &apos;destroy&apos;) {
			if (emitTime == &apos;once&apos;)
				this.life = 1
			else
				this.life = this.emitTotalTimes

		} else if (!isNaN(life)) {
			this.life = life
		}

		this.rate.init()
	}

	/**
	 * stop emiting
	 */
	stopEmit() {
		this.emitTotalTimes = -1
		this.emitTime = 0
	}

	/**
	 * remove current all particles
	 */
	removeAllParticles() {
		var particles = this.particles
		for (var i = 0, l = particles.length; i &lt; l; i++) {
			particles[i].dead = true
		}
	}
	/**
	 * create single particle
	 * 
	 * can use emit({x:10},new Gravity(10),{&apos;particleUpdate&apos;,fun}) or emit([{x:10},new Initialize],new Gravity(10),{&apos;particleUpdate&apos;,fun})
	 */
	createParticle(initialize, behaviour) {
		var particle = pool.get()
		this.setupParticle(particle, initialize, behaviour)
		this.dispatchEvent(PARTICLE_CREATED, particle)
		return particle
	}
	/**
	 * add initialize to this emitter
	 */
	addSelfInitialize(pObj) {
		if (pObj[&apos;init&apos;]) {
			pObj.init(this)
		} else {
			this.initAll()
		}
	}
	/**
	 * add the Initialize to particles
	 * 
	 * you can use initializes array:for example emitter.addInitialize(initialize1,initialize2,initialize3)
	 * @param {Initialize} initialize like this new Radius(1, 12)
	 */
	addInitialize() {
		for (var i = 0, l = arguments.length; i &lt; l; i++) {
			this.initializes.push(arguments[i])
		}
	}
	/**
	 * remove the Initialize
	 * @param {Initialize} initialize a initialize
	 */
	removeInitialize(initializer) {
		var index = this.initializes.indexOf(initializer)
		if (index &gt; -1) {
			this.initializes.splice(index, 1)
		}
	}

	/**
	 * remove all Initializes
	 */
	removeInitializers() {
		this.initializes.length = 0
	}
	/**
	 * add the Behaviour to particles
	 * 
	 * you can use Behaviours array:emitter.addBehaviour(Behaviour1,Behaviour2,Behaviour3)
	 * @param {Behaviour} behaviour like this new Color(&apos;random&apos;)
	 */
	addBehaviour() {
		for (var i = 0, l = arguments.length; i &lt; l; i++) {
			this.behaviours.push(arguments[i])
			if (arguments[i].hasOwnProperty(&quot;parents&quot;))
				arguments[i].parents.push(this)
		}
	}
	/**
	 * remove the Behaviour
	 * @param {Behaviour} behaviour a behaviour
	 */
	removeBehaviour(behaviour) {
		var index = this.behaviours.indexOf(behaviour)
		if (index &gt; -1)
			this.behaviours.splice(index, 1)
	}
	/**
	 * remove all behaviours
	 */
	removeAllBehaviours() {
		this.behaviours.length = 0
	}

	integrate(time) {
		var damping = 1 - this.damping
		integrator.integrate(this, time, damping)
		var particles = this.particles
		for (var i = 0, l = particles.length; i &lt; l; i++) {
			var particle = particles[i]
			particle.update(time, i)
			integrator.integrate(particle, time, damping)

			this.dispatchEvent(PARTICLE_UPDATE, particle)
		}
	}

	emitting(time) {
		if (this.emitTotalTimes == &apos;once&apos;) {
			var count = this.rate.getValue(99999)
			for (var i = count - 1; i &gt;= 0; i--) {
				this.createParticle()
			}

			this.emitTotalTimes = &apos;none&apos;
		} else if (!isNaN(this.emitTotalTimes)) {
			this.emitTime += time
			if (this.emitTime &lt; this.emitTotalTimes) {
				var count = this.rate.getValue(time)
				for (var i = count - 1; i &gt;= 0; i--) {
					this.createParticle()
				}
			}
		}
	}

	update(time) {
		this.age += time
		if ((this.age &gt;= this.life) || this.dead) {
			this.destroy()
			return
		}

		this.emitting(time)
		this.integrate(time)

		var particles = this.particles
		for (var k = particles.length - 1; k &gt;= 0; k--) {
			var particle = this.particles[k]
			if (particle.dead) {
				pool.set(particle)
				particles.splice(k, 1)
				this.dispatchEvent(PARTICLE_DEAD, particle)
			}
		}
	}

	setupParticle(particle, initialize, behaviour) {
		var initializes = this.initializes
		var behaviours = this.behaviours

		if (initialize) {
			if ( initialize instanceof Array)
				initializes = initialize
			else
				initializes = [initialize]
		}

		if (behaviour) {
			if ( behaviour instanceof Array)
				behaviours = behaviour
			else
				behaviours = [behaviour]
		}

		this._initialize(particle, initializes)

		particle.addBehaviours(behaviours)
		particle.parent = this
		this.particles.push(particle)
	}

	_initialize(particle, initializes) {
		for (var i = 0, l = initializes.length; i &lt; l; i++) {
			if (initializes[i] instanceof Initialize) {
				initializes[i].init(this, particle)
			} else {
				console.error(&apos;fuck this shit&apos;)
				setPrototypeByObject(particle, initialize)
				setVector2DByObject(particle, initialize)
			}
		}

		if (this.bindEmitter) {
			particle.p.add(this.p)
			particle.v.add(this.v)
			particle.a.add(this.a)
			particle.v.rotate(degreeTransform(this.rotation))
		}
	}

	/**
	 * Destory this Emitter
	 */
	destroy() {
		this.dead = true
		this.emitTotalTimes = -1
		if (this.particles.length == 0) {
			this.removeInitializers()
			this.removeAllBehaviours()

			if (this.parent)
				this.parent.removeEmitter(this)
		}
	}
}

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.2.6)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
